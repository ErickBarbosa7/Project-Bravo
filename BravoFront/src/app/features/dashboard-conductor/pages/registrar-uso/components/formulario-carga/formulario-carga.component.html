<div *ngIf="!viajeActivo() && !isManualMode()" class="empty-state fade-in">
  <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 21 24"><path fill="currentColor" d="M10.449 0c-3.64 0-6.71.201-7.168.468c-.8.273-1.402 2.09-1.404 4.246v1.071h-.218a.5.5 0 0 0-.088-.135a.6.6 0 0 0 .146-.392v-.544a.49.49 0 0 0-.427-.535H.432a.49.49 0 0 0-.428.539v-.002v.544c0 .15.055.288.146.393l-.001-.001a.6.6 0 0 0-.146.392V8.73q-.002.023-.002.048c0 .25.187.457.429.487h.859A.42.42 0 0 0 1.658 9l.001-.003h.218v4.822c0 .191.205.368.536.463v.626c-.473.061-.8.274-.8.518v5.36a2.96 2.96 0 0 0 .542 1.863l-.006-.009v.921c0 .243.197.44.44.44h1.798a.44.44 0 0 0 .44-.44v-.631h11.247v.631c0 .243.197.44.44.44h1.798a.44.44 0 0 0 .44-.44v-.92a2.96 2.96 0 0 0 .536-1.86v.007v-5.36c0-.244-.331-.457-.8-.518v-.626c.331-.095.535-.272.536-.463v-4.82h.218c.06.152.202.259.369.268h.855a.49.49 0 0 0 .428-.539v.002v-2.686a.6.6 0 0 0-.146-.393l.001.001a.6.6 0 0 0 .146-.392V4.72a.49.49 0 0 0-.427-.535h-.859a.49.49 0 0 0-.428.539v-.002v.544c0 .15.055.288.146.393l-.001-.001a.6.6 0 0 0-.087.131l-.001.003h-.218V4.716c0-2.167-.608-3.992-1.414-4.251c-.49-.266-3.545-.463-7.157-.463zM3.101 3.107h14.695c.259 0 .475.184.525.429l.001.003c.102.51.16 1.097.16 1.698v.038v-.002V9c0 .296-.24.536-.536.536H2.949A.536.536 0 0 1 2.413 9V5.238q.001-.903.169-1.756l-.009.057a.536.536 0 0 1 .526-.432zm.651 11.786H4.9c.143 0 .259.112.267.253v.001l.191 3.482v.014c0 .148-.12.268-.268.268H3.752a.27.27 0 0 1-.268-.268v-3.482c0-.148.12-.268.268-.268m12.245 0h1.148c.148 0 .268.12.268.268v3.479c0 .148-.12.268-.268.268h-1.339a.27.27 0 0 1-.268-.268v-.015v.001l.191-3.482c.01-.14.126-.25.267-.25h.001zm-9.968.64h8.84c.074 0 .134.06.134.134v.16c0 .074-.06.134-.134.134h-8.84a.134.134 0 0 1-.134-.134v-.16c0-.074.06-.134.134-.134m.053.964h8.733c.074 0 .134.06.134.134v.16c0 .074-.06.134-.134.134H6.082a.134.134 0 0 1-.134-.134v-.16c0-.074.06-.134.134-.134m.054.964h8.626c.074 0 .134.06.134.134v.16c0 .074-.06.134-.134.134H6.136a.133.133 0 0 1-.133-.128v-.16c0-.074.06-.134.134-.134zm.054.964h8.518c.074 0 .134.06.134.134v.16c0 .074-.06.134-.134.134H6.19a.134.134 0 0 1-.134-.134v-.16c0-.074.06-.134.134-.134"/></svg></span>
  <p>No tienes un vehículo asignado.</p>
  
  <button class="btn-link" (click)="irAAsistente()">
    Ir al Asistente para elegir uno
  </button>
  
  <p class="divider">- o -</p>
  
  <button class="btn-secondary" (click)="activarManual()">
    Registro Manual
  </button>
</div>

<div *ngIf="viajeActivo() || isManualMode()" class="active-trip-card fade-in">
  
  <div class="trip-header">
    <span class="badge-live" [class.manual]="isManualMode()">
      {{ isManualMode() ? 'REGISTRO MANUAL' : 'EN USO' }}
    </span>
    
    <h3>{{ viajeActivo() ? viajeActivo().modelo : 'Datos de Carga' }}</h3>
    <span class="placa" *ngIf="viajeActivo()">{{ viajeActivo().placa }}</span>
  </div>
  
  <div class="form-card">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      
      <ng-container *ngIf="viajeActivo()">
        <input type="hidden" formControlName="vehiculoId">
      </ng-container>

      <div class="input-group" *ngIf="isManualMode()">
        <label>Seleccionar Vehículo</label>
        <div class="select-wrapper">
          <select formControlName="vehiculoId">
            <option value="" disabled selected>Elige de la lista...</option>
            <option *ngFor="let v of vehiculos()" [value]="v.id">
              {{ v.marca }} {{ v.modelo }} ({{ v.placa }})
            </option>
          </select>
          <div class="chevron">▼</div>
        </div>
      </div>
      
      <div class="input-group">
        <label>Kilómetros Recorridos</label>
        <input type="number" formControlName="kilometrosRecorridos" placeholder="Ej. 150">
        <small class="hint">Desde la última carga</small>
      </div>

      <div class="input-group">
        <label>Litros Cargados</label>
        <input type="number" formControlName="litrosConsumidos" placeholder="Ej. 40.5">
        <small class="hint">Según ticket de gasolinera</small>
      </div>

      <button type="submit" class="btn-submit" [disabled]="isLoading()">
        <span *ngIf="isLoading()" class="loader-mini white"></span>
        <span *ngIf="!isLoading()">Finalizar y Registrar</span>
      </button>
      
      <button type="button" class="btn-cancel-text" (click)="cancelar()">
        Cancelar / Regresar
      </button>

    </form>
  </div>
</div>