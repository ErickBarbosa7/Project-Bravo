<div class="list-container">

  <div class="list-header">
    <h1>Flota de Vehículos</h1>
    <a routerLink="../vehiculos/nuevo" class="btn-primary">
      <i class="pi pi-plus"></i> Añadir Vehículo
    </a>
  </div>

  <!-- LOADING -->
  <div *ngIf="vehiculoService.loading()" class="loading-shade">
    <span class="spinner"></span>
    <p>Cargando vehículos...</p>
  </div>

  <!-- ERROR -->
  <div *ngIf="vehiculoService.error()" class="error-message">
    <h3>Error al cargar</h3>
    <p>{{ vehiculoService.error() }}</p>
    <button (click)="vehiculoService.loadVehiculos()" class="btn-secondary">
      Reintentar
    </button>
  </div>

  <!-- TABLA DE VEHÍCULOS -->
  <div *ngIf="!vehiculoService.loading() && !vehiculoService.error()">

    <!-- ESTADO VACÍO -->
    <div *ngIf="vehiculoService.vehiculos().length === 0" class="empty-state">
      <h3>No hay vehículos registrados</h3>
      <p>Comienza añadiendo el primer vehículo a tu flota.</p>
    </div>

    <!-- VEHÍCULOS -->
    <table *ngIf="vehiculoService.vehiculos().length > 0" class="data-table">
      <thead>
        <tr>
          <th>Foto</th>
          <th>Placa</th>
          <th>Nombre</th>
          <th>Estado</th>
          <th>Kilometraje</th>
          <th>Próximo Servicio</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let vehiculo of vehiculoService.vehiculos()">
          <td>
            <img 
              [src]="vehiculo.fotoUrl || 'assets/vehiculo-placeholder.png'" 
              alt="Foto de {{ vehiculo.nombre }}" 
              class="vehiculo-thumb"
            />
          </td>
          <td><strong>{{ vehiculo.placa }}</strong></td>
          <td>{{ vehiculo.nombre }}</td>
          <td>
            <span class="status-badge" [ngClass]="'status-' + vehiculo.estado?.toLowerCase()">
              {{ vehiculo.estado }}
            </span>
          </td>
          <td>{{ vehiculo.kilometrajeActual | number }} km</td>
          <td>{{ vehiculo.siguienteServicioKm | number }} km</td>
          <td class="actions">
            <button (click)="onEditVehiculo(vehiculo.id)" class="btn-icon btn-edit">
              <i class="pi pi-pencil"></i>
            </button>
            <button (click)="onDeleteVehiculo(vehiculo.id)" class="btn-icon btn-delete">
              <i class="pi pi-trash"></i>
            </button>
            <button (click)="openDetalle(vehiculo.id)" class="btn-info">
              <i class="pi pi-eye"></i> Ver
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- MODAL DETALLE -->
    <app-vehiculo-detalle 
      *ngIf="selectedVehiculo() !== null"
      [vehiculoId]="selectedVehiculo()!"
      (close)="closeDetalle()">
    </app-vehiculo-detalle>

  </div>
</div>
